version: '3'

tasks:
  go:mod:tidy:
    internal: true
    cmds:
      - go mod tidy

  install:frontend:deps:
    internal: true
    dir: frontend
    sources:
      - package.json
      - pnpm-lock.yaml
    generates:
      - node_modules
    cmds:
      - pnpm install

  build:frontend:
    internal: true
    dir: frontend
    deps:
      - task: install:frontend:deps
      - task: generate:bindings
    cmds:
      - pnpm run build
    env:
      PRODUCTION: "true"

  generate:bindings:
    internal: true
    deps:
      - task: go:mod:tidy
    cmds:
      - wails3 generate bindings -clean=true -ts

  generate:icons:
    internal: true
    dir: build
    sources:
      - appicon.png
    generates:
      - darwin/icons.icns
      - windows/icon.ico
    cmds:
      - wails3 generate icons -input appicon.png -macfilename darwin/icons.icns -windowsfilename windows/icon.ico
